<html lang="ja" >
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
  <link rel="stylesheet" type="text/css" href="./style.css" media="all">
  <title>ニホンミツバチクイズ</title>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-32913989-2', 'auto');
    ga('send', 'pageview');
  </script>
</head>
<body ng-app="MyApp" ng-cloak>
<section layout="row" layout-sm="column" layout-align="center center" layout-wrap novalidate>
  <div id="top" ng-controller="AppCtrl">
    <h3>{{ title }}</h3>
    <p>{{ explanation }}</p>
    <form name="questionForm" ng-submit="submit()" ng-cloak >
      <div ng-if="questionForm.$submitted">
        <p class="score">あなたの得点は{{ score }} 点です</p>
      </div>
      <hr />
      <div ng-repeat="(key, question) in questions">
        <p>[問題{{key + 1}}] {{ question.title }}</p>
        <div ng-if="questionForm.$submitted">
          <span class="correct" ng-if="question.value == question.answer">おめでとうございます。正解です。</span>
          <span class="incorrect" ng-if="question.value != question.answer">残念。不正解です。</span>
        </div> 
        <div ng-if="questionForm.$submitted == false">
          <md-radio-group ng-model='question.value' required>
            <md-radio-button name="i-1" value="1" class="md-primary">正しい</md-radio-button>
            <md-radio-button name="i-0" value="0">間違い</md-radio-button>
          </md-radio-group>
	  </div>
          <div ng-if="questionForm.$submitted">
            この記述は
            <span ng-if="question.answer == 1">
              正しい
	    </span>
            <span ng-if="question.answer == 0">
              間違い
	    </span>
            <span>: {{ question.explanation }}</span>
          </div>
        <hr />
      </div>
      <div ng-if="questionForm.$submitted">
        <p class="score">あなたの得点は{{ score }} 点です</p>
        <button ng-click="reset()" type="button">再挑戦する</button>
        <div>
          <span>以下のページで分蜂について学んでみましょう。</span>
          <ul>
            <li><a href="https://syumatsu-yoho.com/38/node/1522" target="_blank">分蜂(分封、ぶんぽう)とは？ニホンミツバチが増える仕組み</a></li>
            <li><a href="https://syumatsu-yoho.com/38/node/55" target="_blank">ニホンミツバチの捕獲方法と捕獲の8つのコツ</a></li>
          </ul>
          <p>他にも、<a href="https://syumatsu-yoho.com/38/" target="_blank">週末養蜂家のニホンミツバチのおいしいはちみつ</a>では、初心者向けの飼育方法を解説しています。本とDVDで学びたい方には<a href="http://korenara.bee-book.net/" target="_blank">これならできる!ニホンミツバチの週末養蜂</a>がオススメです。</p>
          <p>また、ニホンミツバチについての質問は、<a href="https://38qa.net/" target="_blank">ニホンミツバチのQ&A</a>までお寄せください。ニホンミツバチ最大のコミュニティです。</p>
          <p>※このクイズは、京都ニホンミツバチ週末養蜂の会の飼育方法に基づいております。</p>
        </div>
      </div>
      <div ng-if="questionForm.$submitted == false">
        <div ng-show="questionForm.$invalid">
          <span>全て回答してください。</span>
        </div>
        <button class="md-raised md-primary md-button md-ink-ripple" ng-disabled="questionForm.$invalid" type="submit" >
          <span class="ng-scope">採点する</span>
          <div class="md-ripple-container"></div>
        </button>
      </div>
    </form>
  </div>
</section>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.min.js"></script>
<script type="text/javascript">    
  var app = angular.module('MyApp', ['ngMaterial', 'ngRoute']);
  app.config(['$routeProvider', function($routeProvider){
    $routeProvider.when('/:_id', {
      controller: 'AppCtrl'
    });
  }]);
  app.controller('AppCtrl', function($scope, $http, $location, $anchorScroll, $routeParams) {
    var id = $routeParams._id;
    console.log($routeParams);
    if(!id) {
      id = 1;
    }
    var questionFilePath = './api/question' + id + '.json';
    $http.get(questionFilePath).then(function(response) {
      $scope.questions = response.data.questions;
      $scope.title = response.data.title;
      $scope.explanation = response.data.explanation;
      $scope.answer_ref = response.data.answer_ref;

    });

    $scope.submit = function() {

      var correctQuestions = $scope.questions.filter(function(val) {
        return (val.value == val.answer);
      });
      $scope.score = correctQuestions.length / $scope.questions.length * 100;
      ga('send', 'event', 'quiz', 'answer', 'quiz' + id, $scope.score);
      $location.hash('top');
      $anchorScroll();
    }

    $scope.reset = function(){
      angular.forEach($scope.questions, function(value, index) {
        value.value = null;
      });
      $scope.questionForm.$setPristine();
      $location.hash('top');
      $anchorScroll();
    }

  });
</script>
</body>
</html>
